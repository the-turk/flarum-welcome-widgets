{"version":3,"sources":["webpack://@the-turk/flarum-welcome-widgets/webpack/bootstrap","webpack://@the-turk/flarum-welcome-widgets/external \"flarum.core.compat['app']\"","webpack://@the-turk/flarum-welcome-widgets/external \"flarum.core.compat['models/User']\"","webpack://@the-turk/flarum-welcome-widgets/external \"flarum.core.compat['Model']\"","webpack://@the-turk/flarum-welcome-widgets/external \"flarum.core.compat['utils/formatNumber']\"","webpack://@the-turk/flarum-welcome-widgets/external \"flarum.core.compat['helpers/icon']\"","webpack://@the-turk/flarum-welcome-widgets/external \"flarum.core.compat['extend']\"","webpack://@the-turk/flarum-welcome-widgets/external \"flarum.core.compat['components/IndexPage']\"","webpack://@the-turk/flarum-welcome-widgets/external \"flarum.core.compat['helpers/listItems']\"","webpack://@the-turk/flarum-welcome-widgets/external \"flarum.core.compat['components/Dropdown']\"","webpack://@the-turk/flarum-welcome-widgets/external \"flarum.core.compat['components/SessionDropdown']\"","webpack://@the-turk/flarum-welcome-widgets/external \"flarum.core.compat['helpers/humanTime']\"","webpack://@the-turk/flarum-welcome-widgets/external \"flarum.core.compat['utils/extractText']\"","webpack://@the-turk/flarum-welcome-widgets/external \"flarum.core.compat['components/AvatarEditor']\"","webpack://@the-turk/flarum-welcome-widgets/./src/forum/components/UserDropdown.js","webpack://@the-turk/flarum-welcome-widgets/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@the-turk/flarum-welcome-widgets/./src/forum/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","UserDropdown","subClass","superClass","constructor","__proto__","initProps","props","icon","className","buttonClassName","view","this","children","SessionDropdown","items","toArray","Dropdown","localePrefix","app","initializers","add","User","ww_lastLoginDiscussionsCount","Model","attribute","ww_lastLoginPostsCount","ww_lastLoginUsersCount","ww_previousLoginAt","getChangeInfo","currentCount","previousCount","keyword","percentage","toFixed","iconHelper","badgeClass","extend","IndexPage","vdom","user","session","changeInfo","currentStats","discussions","forum","posts","users","previousStats","find","e","attrs","includes","unshift","currentTime","localeKey","username_obj","username","href","route","isValid","currentHour","parseFloat","format","translator","trans","getGreetingTime","moment","component","AvatarEditor","listItems","badges","formatNumber","commentCount","discussionCount","map","type","span","title","extractText","humanTime","date"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 13);\n","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['models/User'];","module.exports = flarum.core.compat['Model'];","module.exports = flarum.core.compat['utils/formatNumber'];","module.exports = flarum.core.compat['helpers/icon'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['components/IndexPage'];","module.exports = flarum.core.compat['helpers/listItems'];","module.exports = flarum.core.compat['components/Dropdown'];","module.exports = flarum.core.compat['components/SessionDropdown'];","module.exports = flarum.core.compat['helpers/humanTime'];","module.exports = flarum.core.compat['utils/extractText'];","module.exports = flarum.core.compat['components/AvatarEditor'];","import Dropdown from 'flarum/components/Dropdown';\nimport SessionDropdown from 'flarum/components/SessionDropdown';\n\n/**\n * The `UserDropdown` component shows a dropdown of session controls.\n */\nexport default class UserDropdown extends Dropdown {\n  static initProps(props) {\n    super.initProps(props);\n\n    props.icon = 'fas fa-ellipsis-v';\n    props.className = 'IndexPage-stats-dropdown';\n    props.buttonClassName = 'Button Button--icon Button--flat';\n  }\n\n  view() {\n    this.props.children = SessionDropdown.prototype.items().toArray();\n\n    return super.view();\n  }\n}\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import { extend } from 'flarum/extend';\nimport app from 'flarum/app';\nimport IndexPage from 'flarum/components/IndexPage';\nimport listItems from 'flarum/helpers/listItems';\nimport iconHelper from 'flarum/helpers/icon';\nimport formatNumber from 'flarum/utils/formatNumber';\nimport UserDropdown from './components/UserDropdown';\nimport User from 'flarum/models/User';\nimport Model from 'flarum/Model';\nimport humanTime from 'flarum/helpers/humanTime';\nimport extractText from 'flarum/utils/extractText';\nimport AvatarEditor from 'flarum/components/AvatarEditor';\n\nconst localePrefix = 'the-turk-welcome-widgets.forum.';\n\napp.initializers.add('the-turk-welcome-widgets', () => {\n  User.prototype.ww_lastLoginDiscussionsCount = Model.attribute('ww_lastLoginDiscussionsCount');\n  User.prototype.ww_lastLoginPostsCount = Model.attribute('ww_lastLoginPostsCount');\n  User.prototype.ww_lastLoginUsersCount = Model.attribute('ww_lastLoginUsersCount');\n  User.prototype.ww_previousLoginAt = Model.attribute('ww_previousLoginAt');\n\n  var getGreetingTime = (currentTime, user) => {\n    let localeKey = 'welcome';\n    const username_obj = { username: <a href={app.route.user(user)}>{user.username()}</a> };\n\n    if (!(!currentTime || !currentTime.isValid())) {\n      const splitAfternoon = 12;\n      const splitEvening = 17;\n      const currentHour = parseFloat(currentTime.format('HH'));\n\n      if (currentHour >= splitAfternoon && currentHour < splitEvening) {\n        localeKey = 'goodAfternoon';\n      } else if (currentHour >= splitEvening) {\n        localeKey = 'goodEvening';\n      } else {\n        localeKey = 'goodMorning';\n      }\n    }\n\n    return app.translator.trans(localePrefix + localeKey, username_obj);\n  };\n\n  var getChangeInfo = (currentCount, previousCount) => {\n    let keyword, icon, percentage;\n\n    if (previousCount == 0) {\n      percentage = 0;\n    } else {\n      percentage = ((currentCount - previousCount) / previousCount) * 100;\n    }\n\n    if (percentage > 0) {\n      keyword = 'up';\n      icon = 'fas fa-chevron-up';\n    } else if (percentage < 0) {\n      percentage = percentage * -1;\n      keyword = 'down';\n      icon = 'fas fa-chevron-down';\n    } else {\n      keyword = 'neutral';\n      icon = 'fas fa-minus';\n    }\n\n    percentage = percentage.toFixed(1) + '%';\n    icon = iconHelper(icon + ' stats-' + keyword);\n    const badgeClass = 'stats-badge stats-' + keyword + ' stats-badge--' + keyword;\n\n    return { percentage: percentage, icon: icon, badgeClass: badgeClass };\n  };\n\n  extend(IndexPage.prototype, 'view', function (vdom) {\n    const user = app.session.user;\n\n    if (!user || !user.ww_previousLoginAt()) return;\n\n    let currentCount, changeInfo, icon;\n    const currentStats = {\n      discussions: app.forum.attribute('ww_discussionsCount'),\n      posts: app.forum.attribute('ww_postsCount'),\n      users: app.forum.attribute('ww_usersCount'),\n    };\n    const previousStats = {\n      discussions: user.ww_lastLoginDiscussionsCount(),\n      posts: user.ww_lastLoginPostsCount(),\n      users: user.ww_lastLoginUsersCount(),\n    };\n    const container = vdom.children.find((e) => e.attrs && e.attrs.className && e.attrs.className.includes('container'));\n\n    container.children.unshift(\n      <div className=\"IndexPage-stats\">\n        {/* User's Panel */}\n        <div className=\"IndexPage-stats-general\">\n          <div className=\"IndexPage-stats-header\">\n            <h4 className=\"stats-greeting\">{getGreetingTime(moment(), user)}</h4>\n            {UserDropdown.component()}\n          </div>\n          <div className=\"IndexPage-stats-body\">\n            <div className=\"Avatar-container\">\n              {AvatarEditor.component({ user })}\n              <ul className=\"badges\">{listItems(user.badges().toArray())}</ul>\n            </div>\n            <div className=\"IndexPage-stats-personal\">\n              <div>\n                <h3>{formatNumber(user.commentCount())}</h3>\n                <p>\n                  <a href={app.route('user.posts', { username: user.username() })}>{app.translator.trans(localePrefix + 'posts')}</a>\n                </p>\n              </div>\n              <div>\n                <h3>{formatNumber(user.discussionCount())}</h3>\n                <p>\n                  <a href={app.route('user.discussions', { username: user.username() })}>{app.translator.trans(localePrefix + 'discussions')}</a>\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n        {/* Posts, Discussions & Users Stats */}\n        {['discussions', 'posts', 'users'].map((type) => {\n          switch (type) {\n            case 'discussions':\n              currentCount = currentStats.discussions;\n              changeInfo = getChangeInfo(currentCount, previousStats.discussions);\n              icon = 'fas fa-bars';\n              break;\n            case 'posts':\n              currentCount = currentStats.posts;\n              changeInfo = getChangeInfo(currentCount, previousStats.posts);\n              icon = 'far fa-comment';\n              break;\n            case 'users':\n              currentCount = currentStats.users;\n              changeInfo = getChangeInfo(currentCount, previousStats.users);\n              icon = 'far fa-user';\n              break;\n          }\n\n          return (\n            <div className={'IndexPage-stats-' + type}>\n              <div className=\"IndexPage-stats-header\">\n                <div className=\"IndexPage-stats-icon\">{iconHelper(icon)}</div>\n                <h4>{app.translator.trans(localePrefix + type)}</h4>\n              </div>\n              <div className=\"IndexPage-stats-body\">\n                <div>\n                  <h3>{[formatNumber(currentCount), changeInfo.icon]}</h3>\n                  <div>\n                    <span className={changeInfo.badgeClass}>{changeInfo.percentage}</span>\n                    <p className=\"stats-since\">\n                      {app.translator.trans(localePrefix + 'sinceLastVisit', {\n                        span: <span title={extractText(humanTime(user.ww_previousLoginAt().date))} className=\"stats-since--text\" />,\n                      })}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    );\n  });\n});\n"],"sourceRoot":""}